import{r as c,k as rt,A as ut,j as ct,l as dt,B as _t,z as bt,o,c as vt,w as Z,a as G,b as t,h as X,v as tt,n as K,f as l,x as R,F as h,d as u,g as T,t as r,C as V,D as pt,S as y,p as mt,i as ht,K as kt}from"./app-1d4323a4.js";import{_ as gt}from"./AuthenticatedLayout-735243b4.js";import{t as f}from"./AlertPlugins-7bad3967.js";import{M as yt}from"./ModalForm-9094d0b9.js";import{_ as ft}from"./_plugin-vue_export-helper-c27b6911.js";const n=x=>(mt("data-v-f3997954"),x=x(),ht(),x),wt={class:"framer--page"},Ct={class:"page-item left--place"},Tt={class:"title--section"},xt=n(()=>t("div",{class:"header--title"},[t("h4",null,"SIMATA Mart"),t("p",null," Cari data barang atau scan barcode untuk menambahkan barang ke keranjang. ")],-1)),Bt={class:"pencarian--title"},St={class:"input-group mb-3"},jt=n(()=>t("i",{class:"bi bi-search"},null,-1)),It=[jt],Kt=n(()=>t("hr",{class:"hr--site"},null,-1)),Mt={class:"content--kategori"},Nt=["onClick"],Pt=n(()=>t("hr",{class:"hr--site"},null,-1)),Rt={class:"frame--barang"},At={key:0,class:"content--barang"},$t={class:"framer--image"},Lt=["src"],Ft={class:"framer--title"},Ot={class:"title--content"},Vt={class:"button--action input-group"},Et=["onClick"],qt=n(()=>t("i",{class:"bi bi-plus"},null,-1)),zt=n(()=>t("span",null,"Tambah",-1)),Dt={key:1,class:"btn btn-sm btn-plus btn-secondary",disabled:"",type:"button"},Qt=n(()=>t("i",{class:"bi bi-plus"},null,-1)),Yt=n(()=>t("span",null,"Kosong",-1)),Ut={key:0,class:"d-flex align-items-center justify-content-center w-100 mt-2"},Jt=n(()=>t("i",{class:"bi bi-arrow-repeat"},null,-1)),Ht=n(()=>t("span",null,"Muat Lebih Banyak",-1)),Wt={key:1,class:"content--barang"},Zt={class:"text-center"},Gt={class:"page-item right--place"},Xt={class:"card radius-10 w-100"},ta={class:"card-body min-height"},aa={class:"btn-group w-100 mb-3"},ea=n(()=>t("i",{class:"bi bi-clock"},null,-1)),sa=n(()=>t("span",{style:{"margin-left":"5px"}},"Riwayat Transaksi",-1)),na=[ea,sa],oa={class:"title--transaction"},la={class:"left--title"},ia=n(()=>t("h4",null," Keranjang Belanja ",-1)),ra={class:"right--title"},ua={key:0,class:"btn-group"},ca=n(()=>t("i",{class:"bi bi-trash"},null,-1)),da=n(()=>t("span",null,"Bersihkan",-1)),_a=n(()=>t("hr",{class:"hr--transaction"},null,-1)),ba={class:"list--transaction"},va={class:"title--item_transaction"},pa={key:0,class:"diskon"},ma={class:"badge bg-success text-white"},ha={class:"harga--transaction"},ka=n(()=>t("span",null,"Harga:",-1)),ga={key:1},ya={class:"button--action input-group"},fa=["onClick"],wa=n(()=>t("i",{class:"bi bi-dash"},null,-1)),Ca=[wa],Ta=["value"],xa=["onClick"],Ba=n(()=>t("i",{class:"bi bi-plus"},null,-1)),Sa=[Ba],ja={class:"result--transaction"},Ia={class:"item--transaction_result"},Ka=n(()=>t("span",null,"Total Pembelian",-1)),Ma={key:0,class:"item--transaction_result"},Na=n(()=>t("span",null,"Pajak",-1)),Pa=n(()=>t("hr",{class:"hr--transaction"},null,-1)),Ra={class:"item--transaction_result btn-group"},Aa=n(()=>t("i",{class:"bi bi-cash"},null,-1)),$a=n(()=>t("span",null,"Tunai",-1)),La=n(()=>t("i",{class:"bi bi-credit-card"},null,-1)),Fa=n(()=>t("span",null,"Non Tunai",-1)),Oa=n(()=>t("i",{class:"bi bi-credit-card"},null,-1)),Va=n(()=>t("span",null,"QRIS",-1)),Ea={class:"item--transaction_result big--title"},qa=n(()=>t("span",null,"Total",-1)),za={class:"item--transaction_result btn--title"},Da=n(()=>t("i",{class:"bi bi-cash"},null,-1)),Qa=n(()=>t("span",null,"Bayar",-1)),Ya={key:1,class:"text-center d-flex align-items-center justify-content-center"},Ua={class:"frame--riwayat"},Ja={class:"list--transaksi"},Ha={class:"item--transaksi input-group"},Wa=n(()=>t("i",{class:"bi bi-search"},null,-1)),Za=[Wa],Ga={class:"item--fix_top_left-with-radius"},Xa={class:"item--fix_top_right-with-radius"},te={class:"title--item_transaksi"},ae={class:"metode_pembayaran"},ee=n(()=>t("span",null,"Metode Pembayaran:",-1)),se={class:"metode_pembayaran"},ne=n(()=>t("span",null,"Total Transaksi:",-1)),oe={class:"metode_pembayaran"},le=n(()=>t("span",null,"Pembayaran Customer:",-1)),ie={class:"metode_pembayaran"},re=n(()=>t("span",null,"Kembalian:",-1)),ue={key:0,class:"metode_pembayaran"},ce=n(()=>t("span",null,"Nomor Referensi:",-1)),de={class:"btn-group"},_e=["onClick"],be=n(()=>t("i",{class:"bi bi-eye"},null,-1)),ve=n(()=>t("span",null,"Lihat Detail",-1)),pe=["onClick"],me=n(()=>t("i",{class:"bi bi-printer"},null,-1)),he=n(()=>t("span",null,"Cetak",-1)),ke={key:1,class:"item--transaksi"},ge={class:"detail--transaksi"},ye={key:0,class:"detail--item_transaksi"},fe=["src"],we={__name:"Kasir",props:{mainData:{type:Object,default:()=>({})},barangs:{type:Object,default:()=>({})},kategori:{type:Array,default:()=>[]}},emits:["closeModal"],setup(x){const k=c("");rt(k,()=>{J()});const at=()=>{A.value=!1},E=(s=null)=>{s!==null&&(w.value=s),setTimeout(()=>{let a=document.getElementById("pdfFrame");a.focus(),a.contentWindow.print()},500)},A=c(!1),p=ut({title:"Tambah Data",mode:"create",icon:"",size:"modal-lg",actionForm:null}),M=c([]),w=c(null),B=c(null),et=()=>{M.value=[],w.value=null,B.value=null},q=async()=>{C.value=!0;const{data:s}=await V.get(route("riwayatTransaksi"),{params:{tanggal:B.value}});M.value=s,s.length>0&&(w.value=s[0]),C.value=!1},z=()=>{et(),B.value=pt().format("YYYY-MM-DD"),p.title="Riwayat Transaksi",p.icon="bi bi-file-bar-graph-fill",p.actionForm=null,p.mode="riwayat",p.size="modal-fullscreen",A.value=!0,q()},m=c("tunai"),D=c(null),L=s=>{m.value=s},st=async()=>{if(m.value==="non tunai"||m.value==="QRIS"){const{value:a}=await y.fire({title:"Nomor Transaksi",input:"text",inputLabel:"Masukan Nomor Transaksi",inputPlaceholder:"Nomor Transaksi ...",showCancelButton:!0,inputValidator:v=>{if(!v)return"Nomor transaksi tidak boleh kosong!"}});if(!a)return;D.value=a}const{value:s}=await y.fire({title:"Total Bayar",input:"number",inputLabel:"Masukan Nominal Uang Customer",inputPlaceholder:"Total Pembayaran ...",showCancelButton:!0,inputValidator:a=>{if(!a)return"Total bayar tidak boleh kosong!"}});if(s){if(s<_.value){f("error","Total bayar tidak boleh kurang dari total belanja.");return}const{value:a}=await y.fire({title:"Silahkan Cek Kembali !",html:`
                <div style="text-align: left;">
                    <p>Nominal Uang : <b>${b(s)}</b></p>
                    <p>Total Pembelian : <b>${b(_.value)}</b></p>
                    <p>Kembalian : <b>${b(s-_.value)}</b></p>
                </div>
            `,icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, bayar!",cancelButtonText:"Tidak, batalkan!",reverseButtons:!0});a&&(m.value,Q(s))}},Q=async s=>{try{let a={total:_.value,total_dibayar:s,metode_pembayaran:m.value,json_transaksi:JSON.stringify(d.value)};(m.value==="non tunai"||m.value==="QRIS")&&(a.ref_transaksi=D.value),await V.post(route("storePembelian"),a),d.value=[],_.value=0,localStorage.removeItem("cart"),localStorage.removeItem("totalBayar"),f("success","Transaksi berhasil dilakukan."),j(),y.fire({title:"Memuat transaksi...",allowOutsideClick:!1,didOpen:()=>{y.showLoading()}}),z(),setTimeout(()=>{y.close(),E()},1500)}catch(a){console.log(a),console.log(a.response.data.message),f("error",a.response.data.message)}},S=c([]),Y=c(0),N=c(1),U=c(1),d=c([]),_=c(0),F=c(0),g=c(""),J=()=>{j(g.value)},b=s=>{var a=s.toString(),v=a.length%3,e=a.substr(0,v),i=a.substr(v).match(/\d{3}/g);if(i){var it=v?".":"";e+=it+i.join(".")}return`Rp. ${e}`},nt=ct(()=>kt().props.auth.user),P=(s,a=!0)=>{if(d.value.find(e=>e.id===s.id)){let e=d.value.findIndex(i=>i.id===s.id);if(a){if(d.value[e].qty+1>s.barang_stok_sisa){f("error","Stok barang tidak mencukupi. Sisa stok: "+s.barang_stok_sisa);return}d.value[e].qty+=1}else d.value[e].qty-1<=0?(d.value.splice(e,1),f("success","Barang berhasil dihapus dari keranjang.")):d.value[e].qty-=1}else d.value.push({...s,qty:1});H()},H=()=>{let s=0;d.value.forEach(a=>{s+=a.qty*a.total_diskon.harga_setelah_diskon}),_.value=s,localStorage.setItem("cart",JSON.stringify(d.value)),localStorage.setItem("totalBayar",_.value)},ot=async()=>{const{value:s}=await y.fire({title:"Anda yakin?",text:"Anda akan menghapus semua barang di keranjang.",icon:"warning",showCancelButton:!0,confirmButtonText:"Ya, hapus semua!",cancelButtonText:"Tidak, batalkan!",reverseButtons:!0});s&&(d.value=[],_.value=0,localStorage.removeItem("cart"),localStorage.removeItem("totalBayar"),f("success","Keranjang berhasil dibersihkan."))},C=c(!1),j=(s="",a=1,v=!1)=>{C.value=!0;const e={query:s,page:a};k.value!==""&&!v&&(e.kategori=k.value),V.get(route("barangs"),{params:e}).then(i=>{v?i.data.data.length>0?P(i.data.data[0]):f("error","Barang tidak ditemukan."):(a>1?S.value=[...S.value,...i.data.data]:S.value=i.data.data,N.value=a,U.value=i.data.last_page,Y.value=i.data.total),C.value=!1}).catch(i=>{console.log(i),C.value=!1})};dt(()=>{$(window).width()>=1199&&$(".wrapper").addClass("toggled"),localStorage.getItem("cart")&&(d.value=JSON.parse(localStorage.getItem("cart")),H()),j(g.value,N.value),window.addEventListener("keydown",W)}),_t(()=>{window.removeEventListener("keydown",W)});const O=c(!1),I=c(""),W=s=>{console.log("mencet"),s.key.length===1&&/[a-zA-Z0-9]/.test(s.key)&&(O.value?I.value+=s.key:(O.value=!0,I.value=s.key)),s.key==="Enter"&&I.value&&(lt(I.value),I.value="",O.value=!1)},lt=s=>{j(s,1,!0)};return(s,a)=>{const v=bt("loading-overlay");return o(),vt(gt,{hideCrumb:!0,hero:!1},{default:Z(()=>[G(v,{active:C.value,"is-full-page":!0,loader:"bars",color:"#2E86C1"},null,8,["active"]),t("div",wt,[t("div",Ct,[t("div",Tt,[xt,t("div",Bt,[t("div",St,[X(t("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>g.value=e),class:"form-control",placeholder:"Cari data barang...","aria-label":"Recipient's username","aria-describedby":"button-addon2"},null,512),[[tt,g.value]]),t("button",{class:"btn btn-primary text-white",type:"button",id:"button-addon2",onClick:a[1]||(a[1]=()=>J())},It)])])]),Kt,t("div",Mt,[t("div",{onClick:a[2]||(a[2]=()=>k.value=""),class:K(`item--kategori btn btn-sm btn-outline-primary ${k.value===""?"active":""}`),type:"button"}," Lihat Semua ",2),(o(!0),l(h,null,R(x.kategori,(e,i)=>(o(),l("div",{key:i,onClick:()=>k.value=e.id,class:K(`item--kategori btn btn-sm btn-outline-primary ${k.value===e.id?"active":""}`),type:"button"},r(e.nama),11,Nt))),128))]),Pt,t("div",Rt,[S.value.length>0?(o(),l("div",At,[(o(!0),l(h,null,R(S.value,(e,i)=>(o(),l("div",{class:"item--barang",key:i},[t("div",$t,[t("img",{src:e.full_path,alt:""},null,8,Lt)]),t("div",Ft,[t("div",Ot,[t("h5",null,r(e.nama),1),t("b",null,r(e.rupiah_hargajual),1)]),t("div",Vt,[e.barang_stok_sisa>0?(o(),l("button",{key:0,class:"btn btn-sm btn-plus btn-success",type:"button",onClick:()=>P(e)},[qt,u(),zt],8,Et)):(o(),l("button",Dt,[Qt,u(),Yt]))])])]))),128)),Y.value>12&&U.value>N.value?(o(),l("div",Ut,[t("button",{class:"btn btn-sm btn-primary p-2",type:"button",onClick:a[3]||(a[3]=()=>j(g.value,N.value+1))},[Jt,u(),Ht])])):T("",!0)])):(o(),l("div",Wt,[t("div",Zt,[g.value==""?(o(),l(h,{key:0},[u(" Tidak Ada Barang ")],64)):(o(),l(h,{key:1},[u(" Barang dengan keyword "),t("b",null,r(g.value),1),u(" tidak ditemukan. ")],64))])]))])]),t("div",Gt,[t("div",Xt,[t("div",ta,[t("div",aa,[t("button",{class:"btn btn-sm btn-outline-danger btn-block p-2 d-flex align-items-center justify-content-center",type:"button",onClick:a[4]||(a[4]=()=>z())},na)]),t("div",oa,[t("div",la,[t("span",null,[u("Kasir bertanggung jawab: "),t("b",null,r(nt.value.name),1)]),ia]),t("div",ra,[d.value.length>0?(o(),l("div",ua,[t("button",{class:"btn",type:"button",onClick:a[5]||(a[5]=()=>ot())},[ca,u(),da])])):T("",!0)])]),_a,d.value.length>0?(o(),l(h,{key:0},[t("div",ba,[(o(!0),l(h,null,R(d.value,(e,i)=>(o(),l("div",{class:"item--transaction_cart",key:i},[t("div",va,[t("b",null,[u(r(e.nama)+" ",1),e.diskon>0?(o(),l("div",pa,[t("i",ma,"Diskon: "+r(e.diskon)+"%",1)])):T("",!0)]),t("span",ha,[ka,e.diskon>0?(o(),l(h,{key:0},[t("i",null,r(b(e.total_diskon.harga_setelah_diskon)),1),u(),t("b",null,r(b(e.hargajual)),1)],64)):(o(),l("i",ga,r(b(e.hargajual)),1))])]),t("div",ya,[t("button",{class:"btn btn-sm btn-danger btn-minus",type:"button",onClick:()=>P(e,!1)},Ca,8,fa),t("input",{type:"text",class:"form-control",placeholder:"Qty","aria-label":"Qty","aria-describedby":"button-addon2",value:e.qty,readonly:""},null,8,Ta),t("button",{class:"btn btn-sm btn-success btn-plus",type:"button",onClick:()=>P(e)},Sa,8,xa)])]))),128))]),t("div",ja,[t("div",Ia,[Ka,t("b",null,r(b(_.value)),1)]),F.value!==0?(o(),l("div",Ma,[Na,t("b",null,r(F.value)+"%",1)])):T("",!0),Pa,t("div",Ra,[t("button",{class:K(`btn btn-sm btn-outline-danger ${m.value==="tunai"?"active":""}`),onClick:a[6]||(a[6]=()=>L("tunai")),type:"button"},[Aa,u(),$a],2),t("button",{class:K(`btn btn-sm btn-outline-danger ${m.value==="non tunai"?"active":""}`),onClick:a[7]||(a[7]=()=>L("non tunai")),type:"button"},[La,u(),Fa],2),t("button",{class:K(`btn btn-sm btn-outline-danger ${m.value==="QRIS"?"active":""}`),onClick:a[8]||(a[8]=()=>L("QRIS")),type:"button"},[Oa,u(),Va],2)]),t("div",Ea,[qa,t("b",null,r(b(_.value+_.value*F.value/100)),1)]),t("div",za,[t("button",{class:"btn btn-success w-100",type:"button",onClick:a[9]||(a[9]=()=>st())},[Da,u(),Qa])])])],64)):(o(),l("div",Ya," Keranjang Masih Kosong "))])])])]),G(yt,{"modal-title":p.title,icon:p.icon,size:p.size,"data-form":{},mode:p.mode,"action-form":p.actionForm,onReset:a[12]||(a[12]=()=>console.log("reset")),isOpen:A.value,onCloseModal:at,upload:!0},{default:Z(()=>[t("div",Ua,[t("div",Ja,[t("div",Ha,[X(t("input",{type:"date","onUpdate:modelValue":a[10]||(a[10]=e=>B.value=e),class:"form-control",placeholder:"Cari data transaksi...","aria-label":"Recipient's username","aria-describedby":"button-addon2"},null,512),[[tt,B.value]]),t("button",{class:"btn btn-primary text-white",onClick:a[11]||(a[11]=()=>q()),type:"button",id:"button-addon2"},Za)]),M.value.length>0?(o(!0),l(h,{key:0},R(M.value,(e,i)=>(o(),l("div",{class:"item--transaksi item--transaksi_data",key:i},[t("div",Ga,r(e.tanggal_transaksi),1),t("div",Xa," Kasir: "+r(e.nama_kasir),1),t("div",te,[t("b",null,r(i+1)+". Kode Transansaksi: "+r(e.nomor_referensi),1),t("span",ae,[ee,u(),t("b",null,r(e.metode_pembayaran),1)]),t("span",se,[ne,u(),t("b",null,r(b(e.total)),1)]),t("span",oe,[le,u(),t("b",null,r(b(e.bayar)),1)]),t("span",ie,[re,u(),t("b",null,r(b(e.kembalian)),1)]),e.ref_transaksi?(o(),l("span",ue,[ce,u(),t("b",null,r(e.ref_transaksi),1)])):T("",!0)]),t("div",de,[t("button",{class:"btn btn-sm btn-outline-primary",type:"button",onClick:()=>w.value=e},[be,u(),ve],8,_e),t("button",{class:"btn btn-sm btn-outline-success",type:"button",onClick:()=>E(e)},[me,u(),he],8,pe)])]))),128)):(o(),l("div",ke," Tidak Ada Transaksi Pada Tanggal Ini. "))]),t("div",ge,[w.value?(o(),l("div",ye,[t("iframe",{id:"pdfFrame",src:s.route("printStruk",w.value.id),width:"100%",height:"600px"},null,8,fe)])):T("",!0)])])]),_:1},8,["modal-title","icon","size","mode","action-form","isOpen"])]),_:1})}}},je=ft(we,[["__scopeId","data-v-f3997954"]]);export{je as default};
